[sssd]
services = nss, pam
domains = mila.quebec

[domain/mila.quebec]
ldap_tls_cert = /etc/sssd/certs/{{ gsuite_cert_name }}.crt
ldap_tls_key = /etc/sssd/certs/{{ gsuite_cert_name }}.key
ldap_uri = ldaps://ldap.google.com
ldap_search_base = {{ gsuite_search_base }}
ldap_user_search_base = {{ gsuite_user_search_base }}
ldap_group_search_base = {{ gsuite_group_search_base }}
id_provider = ldap
auth_provider = ldap
ldap_schema = rfc2307bis
ldap_user_name = posixUid
ldap_user_uuid = entryUUID
ldap_user_gecos = googleUid
{% if ansible_facts['distribution_release'] == 'focal' %}
# GEN-977 - Google LDAP is not compatible with TLS 1.3 in Ubuntu 20.04
ldap_tls_cipher_suite = NORMAL:!VERS-TLS1.3
{% endif %}

# Access control
access_provider = simple
simple_allow_groups = {{ gsuite_authorized_groups }}

# Set default Home to Flash server
override_homedir = /home/mila/%l/%u

# Allow same UID/GID
auto_private_groups = true

# No cache cleaning
ldap_purge_cache_timeout = 0

# Do not download full list for getent group
ignore_group_members = true
