# {{ ansible_managed }}
user {{ nginx_user }};
worker_processes auto;
include /etc/nginx/modules-enabled/*.conf;

http {
     sendfile on;
     tcp_nopush on;
     types_hash_max_size 2048;
     server_tokens off;

     # default is 8k
     client_body_buffer_size 1k;
     # default is 1m
     client_max_body_size 16M;

     # default is 60s
     client_body_timeout 10s;
     # default is 60s
     client_header_timeout 10s;

     include /etc/nginx/mime.types;
     default_type application/octet-stream;

     add_header X-Frame-Options SAMEORIGIN;
     add_header Strict-Transport-Security max-age=31536000;
     add_header X-Content-Type-Options nosniff;

     log_format  main_ext  '$remote_addr - $remote_user [$time_local] "$request" '
                           '$status $body_bytes_sent "$http_referer" '
                           '"$http_user_agent" "$http_x_forwarded_for" '
                           '"$host" sn="$server_name" '
                           'rt=$request_time '
                           'ua="$upstream_addr" us="$upstream_status" '
                           'ut="$upstream_response_time" ul="$upstream_response_length" '
                           'cs=$upstream_cache_status' ;

     access_log  {{ nginx_log_dir }}/access.log main_ext;
     error_log   {{ nginx_log_dir }}/error.log  warn;

     gzip on;

     ssl_certificate /etc/ssl/nginx_proxy.crt;
     ssl_certificate_key /etc/ssl/nginx_proxy.key;

     include /etc/nginx/conf.d/*.conf;
     include /etc/nginx/sites-enabled/*;
}